services:
  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    ports:
      - "32400:32400/tcp"
      # Note: Ports 1900 and 5353 often conflict with system services (SSDP/mDNS)
      # Uncomment if needed and not conflicting on your system
      # - "1900:1900/udp"
      # - "5353:5353/udp"
      - "8324:8324/tcp"
      - "32410:32410/udp"
      - "32412:32412/udp"
      - "32413:32413/udp"
      - "32414:32414/udp"
      - "32469:32469/tcp"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
      - VERSION=docker
      # PLEX_CLAIM will be set dynamically by the web dashboard during installation
      # If not provided during install, users can claim their server via the Plex web UI
      - PLEX_CLAIM=${PLEX_CLAIM:-}
    volumes:
      # Plex configuration and metadata
      - /home/containers/plex/config:/config
      # Media library - organized by type
      - /home/containers/plex/media/movies:/movies
      - /home/containers/plex/media/tv:/tv
      - /home/containers/plex/media/music:/music
      # Optional: Transcode directory (can use tmpfs for better performance)
      - /home/containers/plex/transcode:/transcode
    restart: unless-stopped
    # Uncomment the devices section below to enable hardware transcoding (Intel QuickSync/VAAPI)
    # Requires /dev/dri to exist on your system (GPU with hardware encoding support)
    # devices:
    #   - /dev/dri:/dev/dri
    labels:
      # Metadata for openHomeStack dashboard
      - "openhomestack.service=plex"
      - "openhomestack.name=Plex Media Server"
      - "openhomestack.description=Stream your personal media library"
      - "openhomestack.icon=film"
      - "openhomestack.category=media"
      - "openhomestack.url=http://localhost:32400/web"
      # Installation prompts for web dashboard
      - "openhomestack.install.prompt.claim_token=Plex Claim Token (optional - get from plex.tv/claim)"