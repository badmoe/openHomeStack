version: '3.8'

services:
  wireguard:
    image: linuxserver/wireguard:latest
    container_name: gaming-vpn
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
      - SERVERURL=${SERVER_URL:-auto}
      - SERVERPORT=51820
      - PEERS=${VPN_PEERS:-5}
      - PEERDNS=auto
      - INTERNAL_SUBNET=10.13.13.0
      - ALLOWEDIPS=10.13.13.0/24
    volumes:
      - C:\containers\gaming-vpn\config:/config
      # /lib/modules mount removed for Windows testing - required on Linux
      # - /lib/modules:/lib/modules
    ports:
      - "51820:51820/udp"
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
    restart: unless-stopped
    labels:
      # Metadata for openHomeStack dashboard
      - "openhomestack.service=gaming-vpn"
      - "openhomestack.name=Gaming VPN"
      - "openhomestack.description=WireGuard VPN for secure multiplayer gaming"
      - "openhomestack.icon=gamepad"
      - "openhomestack.category=networking"
      - "openhomestack.url="
      # Installation prompts for web dashboard
      - "openhomestack.install.prompt.server_url=Server URL or Public IP (for auto-detection, leave blank)"
      - "openhomestack.install.prompt.vpn_peers=Number of Peer Configurations to Generate (default: 5)"
