version: '3.8'

services:
  romm:
    image: rommapp/romm:latest
    container_name: romm
    ports:
      - "8080:8080"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
      # Database configuration
      - DB_HOST=romm-db
      - DB_PORT=3306
      - DB_USER=romm
      - DB_NAME=romm
      - DB_PASSWD=${ROMM_DB_PASSWORD:-romm}
      # Authentication secret key (required)
      - ROMM_AUTH_SECRET_KEY=${ROMM_AUTH_SECRET_KEY:-changeme-secret-key-for-romm}
      # Optional: IGDB API credentials for enhanced metadata
      - IGDB_CLIENT_ID=${IGDB_CLIENT_ID:-}
      - IGDB_CLIENT_SECRET=${IGDB_CLIENT_SECRET:-}
    volumes:
      # ROMM application data and database
      - C:\containers\romm\data:/romm/library
      - C:\containers\romm\config:/romm/config
      # ROM files - organized by platform
      - C:\containers\romm\roms:/romm/roms
      # Assets (covers, screenshots, etc.)
      - C:\containers\romm\assets:/romm/assets
    restart: unless-stopped
    depends_on:
      - romm-db
    labels:
      # Metadata for openHomeStack dashboard
      - "openhomestack.service=romm"
      - "openhomestack.name=ROMM"
      - "openhomestack.description=Retro game ROM library manager"
      - "openhomestack.icon=gamepad"
      - "openhomestack.category=media"
      - "openhomestack.url=http://localhost:8080"
      # Installation prompts for web dashboard
      - "openhomestack.install.prompt.db_password=Database Password (default: romm)"
      - "openhomestack.install.prompt.igdb_client_id=IGDB Client ID (optional - for game metadata)"
      - "openhomestack.install.prompt.igdb_client_secret=IGDB Client Secret (optional)"

  romm-db:
    image: mariadb:latest
    container_name: romm-db
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=${ROMM_DB_PASSWORD:-romm}
      - MYSQL_DATABASE=romm
      - MYSQL_USER=romm
      - MYSQL_PASSWORD=${ROMM_DB_PASSWORD:-romm}
    volumes:
      - C:\containers\romm\database:/var/lib/mysql
    restart: unless-stopped
